# 数据库：docker-compose.yml / 本地运行均直接读取 DATABASE_URL
# SQLite（默认；适合本地开发）：会在 `.data/` 下生成 dev.db（避免污染仓库根目录）
DATABASE_URL=sqlite:///./.data/dev.db

# PostgreSQL 示例（启用 docker compose 的 postgres profile 时使用）：
# 推荐写法：postgresql+psycopg（psycopg3）
# DATABASE_URL=postgresql+psycopg://flow:postgres_password_change_me@postgres:5432/flow
# 兼容写法：postgresql://...（应用与 Alembic 会自动规范化到 postgresql+psycopg）

# Docker Compose（PostgreSQL）容器配置：
# - 仅当你使用 postgres profile 时才需要
# - 生产环境务必修改 POSTGRES_PASSWORD
POSTGRES_DB=flow
POSTGRES_USER=flow
POSTGRES_PASSWORD=postgres_password_change_me
POSTGRES_PORT=5432

# Docker Compose：宿主机对外暴露端口（默认 31031）
FLOW_BACKEND_PORT=31031
# Docker Compose：绑定监听地址（生产建议 127.0.0.1，由 Nginx 统一反代）
FLOW_BACKEND_BIND_HOST=127.0.0.1

# Runtime environment: development | production
ENVIRONMENT=development

# Memos 实例（App 拿到 token 后会直连此地址）
MEMOS_BASE_URL=https://memos.example.com

# Memos 管理员 Token（用于创建用户）
MEMOS_ADMIN_TOKEN=

# CORS 允许来源（逗号分隔；开发可用 *）
CORS_ALLOW_ORIGINS=*

# Sharing: public URL used when generating share links
PUBLIC_BASE_URL=http://localhost:31031

# Sharing token signing secret（生产环境务必修改为高强度随机值）
SHARE_TOKEN_SECRET=share_token_secret_change_me

# Attachments: local storage directory (when not using S3)
ATTACHMENTS_LOCAL_DIR=.data/attachments

# Attachments: max upload size (bytes). 0 means unlimited (NOT recommended for production).
ATTACHMENTS_MAX_SIZE_BYTES=26214400

# S3 / COS（可选；留空表示禁用）
S3_ENDPOINT_URL=
S3_REGION=
S3_BUCKET=
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
# If true, use path-style URLs（部分 S3 兼容服务需要）
S3_FORCE_PATH_STYLE=false

# Admin 控制台 Basic Auth（生产务必修改）
ADMIN_BASIC_USER=admin
ADMIN_BASIC_PASSWORD=admin_password_change_me
ADMIN_SESSION_SECRET=admin_session_secret_change_me
# 管理后台会话有效期（秒）
ADMIN_SESSION_MAX_AGE_SECONDS=43200
# 管理后台会话 Cookie 名称（一般无需修改）
ADMIN_SESSION_COOKIE_NAME=flow_admin_session

# 用户（非管理员）Cookie Session（Web SPA 使用；生产环境务必修改 USER_SESSION_SECRET）
USER_SESSION_SECRET=user_session_secret_change_me
# 用户会话有效期（秒）
USER_SESSION_MAX_AGE_SECONDS=2592000
# 用户会话 Cookie 名称（一般无需修改）
USER_SESSION_COOKIE_NAME=flow_session
# CSRF Header 名称（一般无需修改）
USER_CSRF_HEADER_NAME=X-CSRF-Token

# 用户密码可逆加密（用于 /admin 展示“真实密码”）
# 生产环境务必修改：一旦该 key 泄漏，所有可解密的历史密码都会暴露。
# 生成方式（Linux）：
#   python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
USER_PASSWORD_ENCRYPTION_KEY=ITfQicSA5iZ34TlOneaqNmrDcDG8ZtPVCx3IE7lu_L4=

# Memos API 兼容：endpoint 尝试列表（逗号分隔，按顺序尝试）
# 示例：创建用户用 /api/v1/users；创建 token 用 /api/v1/users/{user_id}/accessTokens
MEMOS_CREATE_USER_ENDPOINTS=/api/v1/users
MEMOS_CREATE_TOKEN_ENDPOINTS=/api/v1/users/{user_id}/accessTokens

# Memos notes connector: endpoint overrides (逗号分隔，按顺序尝试)
MEMOS_NOTE_LIST_ENDPOINTS=/api/v1/memos
MEMOS_NOTE_UPSERT_ENDPOINTS=/api/v1/memos
MEMOS_NOTE_DELETE_ENDPOINTS=/api/v1/memos/{memo_id}

# 旧数据修复：当用户名在 Memos 已存在但后端库里不存在时，是否允许后端用管理员权限重置该用户的 Memos 密码
# 用途：修复“账号已创建但 token 生成失败”导致的半成品用户。生产环境默认建议 false。
MEMOS_ALLOW_RESET_PASSWORD_FOR_EXISTING_USER=false

# 开发兜底：true 时不调用 Memos，仅生成本地假 Token（生产务必为 false）
DEV_BYPASS_MEMOS=false

# 日志等级：DEBUG/INFO/WARNING/ERROR
LOG_LEVEL=INFO

# Sync (offline/multi-device): max allowed client clock skew in seconds
SYNC_MAX_CLIENT_CLOCK_SKEW_SECONDS=300

# Sync: pull max events per page
SYNC_PULL_LIMIT=200

# Default TZID (RRULE/local datetime)
DEFAULT_TZID=Asia/Shanghai

# Proxy headers（仅在可信反代后启用）
TRUST_X_FORWARDED_FOR=false
TRUST_X_FORWARDED_PROTO=false

# Web 静态站同源托管（可选）
# - 后端会在启动时“尽力”挂载 `web/out` 到 `/`（仅当存在 index.html）
# - 若你不希望后端托管 Web（只做 API），可显式禁用
# FLOW_DISABLE_WEB_STATIC=1
# - 覆写导出目录（默认：仓库内 web/out；容器内为 /app/web/out）
# FLOW_WEB_OUT_DIR=

# Device tracking: true to persist after response in background task (tests may set false)
DEVICE_TRACKING_ASYNC=true

# Rate limiting (best-effort; reduce brute-force)
RATE_LIMIT_WINDOW_SECONDS=300
RATE_LIMIT_RETENTION_SECONDS=86400
RATE_LIMIT_CLEANUP_INTERVAL_SECONDS=600
AUTH_LOGIN_RATE_LIMIT_PER_IP=30
AUTH_LOGIN_RATE_LIMIT_PER_IP_USER=10
AUTH_REGISTER_RATE_LIMIT_PER_IP=10
ADMIN_LOGIN_RATE_LIMIT_PER_IP=20
